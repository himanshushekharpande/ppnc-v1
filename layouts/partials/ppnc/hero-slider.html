<section class="relative w-full overflow-hidden pt-20 md:pt-24">
  <div class="relative w-full h-[50vh] md:h-hero min-h-[400px] max-h-[600px]">

    <div class="hero-slider absolute inset-0 z-0">
      {{ $slides := site.Params.hero.slides }}
      {{ range $i, $slide := $slides }}
      <div class="hero-slide absolute inset-0 w-full h-full opacity-0 pointer-events-none transition-opacity duration-500 {{ if eq $i 0 }}opacity-100 pointer-events-auto active{{ end }}">
        <picture>
          {{/* ---------- MOBILE ---------- */}}
          {{ $m := $slide.mobile }}
          {{ $m2 := replace $m ".webp" "@2x.webp" }}
          {{ $m2Exists := fileExists (printf "static/%s" $m2) }}

          <source media="(max-width: 768px)"
                  srcset='{{ $m | relURL }}{{ if $m2Exists }}, {{ $m2 | relURL }} 2x{{ end }}'
                  sizes="(max-width:768px) 100vw">

          {{/* ---------- TABLET ---------- */}}
          {{ $t := $slide.tablet }}
          {{ $t2 := replace $t ".webp" "@2x.webp" }}
          {{ $t2Exists := fileExists (printf "static/%s" $t2) }}

          <source media="(min-width:769px) and (max-width:1024px)"
                  srcset='{{ $t | relURL }}{{ if $t2Exists }}, {{ $t2 | relURL }} 2x{{ end }}'
                  sizes="(min-width:769px) and (max-width:1024px) 100vw">

          {{/* ---------- DESKTOP (fallback <img>) ---------- */}}
          {{ $d := $slide.desktop }}
          {{ $d2 := replace $d ".webp" "@2x.webp" }}
          {{ $d2Exists := fileExists (printf "static/%s" $d2) }}

          <img src="{{ $d | relURL }}"
               srcset='{{ $d | relURL }}{{ if $d2Exists }}, {{ $d2 | relURL }} 2x{{ end }}'
               sizes="100vw"
               alt="{{ $slide.title }}"
               class="w-full h-full object-cover"
               {{ if eq $i 0 }}loading="eager" fetchpriority="high"{{ else }}loading="lazy"{{ end }}
               decoding="async">
        </picture>

        <!-- Overlay specific to each slide (minimal CTA) -->
        <div class="absolute inset-0 z-20 flex items-end text-white">
          <div class="container-site pb-6 md:pb-10">
            <div class="max-w-2xl drop-shadow-lg w-full flex justify-center">
              {{ with $slide.ctaLink }}
              <a href="{{ . }}"
                 class="inline-flex items-center justify-center px-5 py-2 rounded-full text-sm md:text-base font-semibold shadow-lg transition-transform transform hover:-translate-y-0.5
                        bg-gradient-to-r from-[#ff6b35] to-[#ff8f5a] text-white hero-cta-bg pointer-events-auto">
                {{ $slide.ctaText }}
              </a>
              {{ end }}
            </div>
          </div>
        </div>
      </div>
      {{ end }}
    </div>

    <!-- Dots & Arrows -->
    <div class="absolute bottom-4 left-1/2 -translate-x-1/2 z-30 flex space-x-2">
      {{ range $i, $_ := $slides }}
      <button class="slider-dot w-3 h-3 rounded-full bg-white/50 hover:bg-white/80 transition-colors {{ if eq $i 0 }}active{{ end }}" data-slide="{{ $i }}" aria-label="Go to slide {{ add $i 1 }}"></button>
      {{ end }}
    </div>

    <button class="slider-prev absolute left-4 top-1/2 -translate-y-1/2 z-30 text-white/80 hover:text-white bg-black/30 hover:bg-black/50 rounded-full p-2 transition-all" aria-label="Previous slide">
      <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"/></svg>
    </button>
    <button class="slider-next absolute right-4 top-1/2 -translate-y-1/2 z-30 text-white/80 hover:text-white bg-black/30 hover:bg-black/50 rounded-full p-2 transition-all" aria-label="Next slide">
      <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/></svg>
    </button>
  </div>
</section>

<script>
document.addEventListener('DOMContentLoaded',()=>{
  const slides=[...document.querySelectorAll('.hero-slide')],
        dots=[...document.querySelectorAll('.slider-dot')],
        prev=document.querySelector('.slider-prev'),
        next=document.querySelector('.slider-next');
  let i=0,timer;
  const show=n=>{
    slides.forEach(s=>s.classList.remove('active','opacity-100','pointer-events-auto'));
    dots.forEach(d=>d.classList.remove('active'));
    i=(n+slides.length)%slides.length;
    slides[i].classList.add('active','opacity-100','pointer-events-auto');
    dots[i].classList.add('active');
  };
  const auto=()=>timer=setInterval(()=>show(i+1),5000);
  const stop=()=>clearInterval(timer);
  next.addEventListener('click',()=>show(i+1));
  prev.addEventListener('click',()=>show(i-1));
  dots.forEach((d,idx)=>d.addEventListener('click',()=>show(idx)));
  const slider=document.querySelector('.hero-slider');
  slider.addEventListener('mouseenter',stop);
  slider.addEventListener('mouseleave',auto);

  show(0); // ensure starting slide is visible
  auto();
});
</script>