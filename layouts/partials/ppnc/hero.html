{{/* layouts/partials/ppnc/hero.html
   Safe hero partial that picks hero in this order:
   1) page front-matter: .Params.hero
   2) params.hero.program_heroes by slug (works for _index pages)
   3) params.hero.pages by .Section (fallback)
   Avoids calling .File when not present and builds desktop/tablet/mobile paths.
*/}}

{{/* --- helper: start with empty heroID in global scratch */}}
{{ $.Scratch.Set "heroID" "" }}

{{ if .IsHome }}
  {{/* Homepage: render slider and stop — do not continue to render the single-hero code */}}
  {{ partial "ppnc/hero-slider.html" . }}
{{ else }}
  {{/* === Non-home pages: determine hero === */}}

  {{/* 1) If this is a page, check front-matter hero */}}
  {{ if .IsPage }}
    {{ with .Params.hero }}
      {{ $.Scratch.Set "heroID" . }}
    {{ end }}

    {{/* 2) If still empty, derive a reliable slug and check program_heroes mapping */}}
    {{ if eq ($.Scratch.Get "heroID") "" }}
      {{ $slug := "" }}
      {{ $base := .File.BaseFileName }}
      {{ if or (eq $base "index") (eq $base "_index") }}
        {{ $dir := .File.Dir }}               {{/* e.g. "programs/bsc-nursing" */}}
        {{ $parts := split $dir "/" }}
        {{ $slug = index $parts (sub (len $parts) 1) }}
      {{ else }}
        {{ $slug = $base }}
      {{ end }}
      {{ with index site.Params.hero.program_heroes $slug }}
        {{ $.Scratch.Set "heroID" . }}
      {{ end }}
    {{ end }}
  {{ end }}

  {{/* 3) If heroID not set yet, try section-level params.hero.pages lookup */}}
  {{ $heroDict := dict }}
  {{ if eq ($.Scratch.Get "heroID") "" }}
    {{ with index site.Params.hero.pages .Section }}
      {{ $heroDict = . }}
    {{ else }}
      {{/* No section mapping — optionally set a default artboard ID */}}
      {{ $.Scratch.Set "heroID" "pwt-logo-ver2Artboard-1" }}
    {{ end }}
  {{ end }}

  {{/* 4) If heroID is set (artboard-style), create heroDict from naming convention */}}
  {{ if ne ($.Scratch.Get "heroID") "" }}
    {{ $hid := $.Scratch.Get "heroID" }}
    {{ $heroDict = dict
          "desktop" (printf "img/hero/%sdesktop-w.webp" $hid)
          "tablet"  (printf "img/hero/%stab-h.webp" $hid)
          "mobile"  (printf "img/hero/%s.webp" $hid)
          "title"   (or .Title "")
    }}
  {{ end }}

  {{/* 5) Render the hero if heroDict is available */}}
  {{ with $heroDict }}
  <section class="relative w-full overflow-hidden pt-20 md:pt-24">
    <div class="relative w-full h-[40vh] md:h-[60vh] min-h-[300px] max-h-[500px]">
      <picture>
        {{/* ---------- MOBILE ---------- */}}
        {{ $mobile := .mobile }}
        {{ $mobile2 := replace $mobile ".webp" "@2x.webp" }}
        {{ $mobile2Exists := fileExists (printf "static/%s" $mobile2) }}

        <source media="(max-width: 768px)"
                srcset='{{ $mobile | relURL }}{{ if $mobile2Exists }}, {{ $mobile2 | relURL }} 2x{{ end }}'
                sizes="100vw">

        {{/* ---------- TABLET ---------- */}}
        {{ $tablet := .tablet }}
        {{ $tablet2 := replace $tablet ".webp" "@2x.webp" }}
        {{ $tablet2Exists := fileExists (printf "static/%s" $tablet2) }}

        <source media="(min-width:769px) and (max-width:1024px)"
                srcset='{{ $tablet | relURL }}{{ if $tablet2Exists }}, {{ $tablet2 | relURL }} 2x{{ end }}'
                sizes="100vw">

        {{/* ---------- DESKTOP (fallback <img>) ---------- */}}
        {{ $desk := .desktop }}
        {{ $desk2 := replace $desk ".webp" "@2x.webp" }}
        {{ $desk2Exists := fileExists (printf "static/%s" $desk2) }}

        <img src="{{ $desk | relURL }}"
             srcset='{{ $desk | relURL }}{{ if $desk2Exists }}, {{ $desk2 | relURL }} 2x{{ end }}'
             sizes="100vw"
             alt="{{ .title }}"
             class="w-full h-full object-cover"
             loading="eager"
             decoding="async">
      </picture>

      {{/* Minimal CTA overlay — adjust or remove per your button-only preference */}}
      <div class="absolute inset-0 z-20 flex items-end md:items-end text-white">
        <div class="container-site pb-6 md:pb-10">
          <div class="w-full flex justify-center">
            {{ $sectionHero := index site.Params.hero.pages .Section }}
            {{ if $sectionHero }}
              {{ with $sectionHero.ctaLink }}
                <a href="{{ . }}" class="btn btn-primary">{{ $sectionHero.ctaText }}</a>
              {{ end }}
            {{ end }}
          </div>
        </div>
      </div>
    </div>
  </section>
  {{ end }}
{{ end }}