<div class="max-w-3xl mx-auto my-12 px-6">
  <h2 class="text-2xl font-bold mb-4 text-marian-blue">Contact Us</h2>

  <form id="contact-form"
        class="space-y-6 bg-white p-6 rounded-lg shadow-md border border-gray-200">

    <input type="hidden" name="form_type" value="contact">
    <input type="hidden" name="redirect" value="{{ "contact/thank-you/" | absURL }}">
    <input type="hidden" name="referer" id="referer-contact" value="">
    <input type="hidden" name="t0" id="t0-contact" value="">
    <div class="hidden">
      <label>Leave this field empty</label>
      <input type="text" name="website" autocomplete="off">
    </div>

    <!-- Name -->
    <div>
      <label for="name" class="block text-sm font-medium text-gray-700">Full Name</label>
      <input type="text" id="name" name="name" required
             class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-marian-blue focus:ring-marian-blue sm:text-sm">
    </div>

    <!-- Email -->
    <div>
      <label for="email" class="block text-sm font-medium text-gray-700">Email</label>
      <input type="email" id="email" name="email" required
             class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-marian-blue focus:ring-marian-blue sm:text-sm">
    </div>

    <!-- Phone -->
    <div>
      <label for="phone" class="block text-sm font-medium text-gray-700">Phone</label>
      <input type="tel" id="phone" name="phone"
             class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-marian-blue focus:ring-marian-blue sm:text-sm">
    </div>

    <!-- Message -->
    <div>
      <label for="message" class="block text-sm font-medium text-gray-700">Message</label>
      <textarea id="message" name="message" rows="4" required
                class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-marian-blue focus:ring-marian-blue sm:text-sm"></textarea>
    </div>

    <!-- Submit -->
    <div>
      <button type="submit" id="contact-submit"
            class="w-full px-5 py-3 rounded-lg bg-marian-blue text-white font-semibold hover:bg-resolution-blue transition">
      Send Message
      </button>
    </div>
  </form>

  <script>
  (function () {
    // Fill hidden fields
    const refererEl = document.getElementById('referer-contact');
    const t0El = document.getElementById('t0-contact');
    if (refererEl) refererEl.value = location.href;
    if (t0El) t0El.value = Date.now();

    const form = document.getElementById('contact-form');
    const submitBtn = document.getElementById('contact-submit');

    // Use the endpoint from your Hugo config param to avoid hardcoding:
    const endpoint = '{{ .Site.Params.googleFormEndpoint }}'; 
    // If you haven't added the param, replace the above with your Apps Script url string.

    form.addEventListener('submit', async function (e) {
      e.preventDefault();

      // basic UI lock
      submitBtn.disabled = true;
      const prevText = submitBtn.textContent;
      submitBtn.textContent = 'Sending...';

      // honeypot quick-check client-side (helps UX)
      if (form.website && form.website.value) {
        console.warn('Honeypot filled — aborting submit.');
        submitBtn.disabled = false; submitBtn.textContent = prevText;
        return;
      }

      const formData = new FormData(form);

      try {
        const res = await fetch(endpoint, { method: 'POST', body: formData });
        const text = await res.text().catch(()=>null);
        let data = null;
        try { data = JSON.parse(text); } catch(_) { data = null; }

        if (res.ok && data && data.ok) {
          // Use redirect sent by Apps Script, else fallback to site redirect
          const redirect = data.redirect || '{{ "contact/thank-you/" | absURL }}';
          window.location.href = redirect;
          return;
        }

        if (res.ok && !data) {
          // older Apps Script HTML redirect behaviour — fallback to static redirect
          window.location.href = '{{ "contact/thank-you/" | absURL }}';
          return;
        }

        // non-OK
        console.error('Contact submit failed', { status: res.status, body: text });
        alert('Submission failed. Try again later.');
      } catch (err) {
        console.error('Network/submit error', err);
        alert('Network error. Please try again.');
      } finally {
        submitBtn.disabled = false;
        submitBtn.textContent = prevText;
      }
    });
  })();
  </script>
</div>